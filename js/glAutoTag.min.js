/*
	glAutoTag v1.0 - http://code.gautamlad.com/glAutoTag/
	Compiled using Google Closure Compiler - http://closure-compiler.appspot.com/home
*/
(function(d){var j={cssName:"default",delimiter:" ",keyDelay:10,onChange:null,onLookup:null},e={keyTimer:0,init:function(b){return this.each(function(){var a=d(this),c=d.extend({},j);b&&(c=d.extend(c,b));a.data("settings",c);a.keyup(e.keyup).keydown(e.keydown).keypress(e.keypress);e.create.apply(d(this));d(window).bind("click",function(){e.hide.apply(a)})})},create:function(){var b=d(this),a=b.data("settings"),c=a.cssName;a.box=d("<div class='_glat-box glat-"+c+"-box'><div class='_glat-input-box glat-"+
c+"-input-box'></div><div class='_glat-result-box glat-"+c+"-result-box'><ul class='_glat-results'></ul></div><div class='_glat-tags-box glat-"+c+"-tags-box'><ul class='_glat-tags'></ul></div></div>");a.tList=a.box.find("ul._glat-tags");a.rList=a.box.find("ul._glat-results");b.after(a.box);b.appendTo(a.box.find("div._glat-input-box"))},show:function(){var b=d(this),a=b.data("settings");e.hide.apply(d(this));a.rList.parent().show().offset({left:b.offset().left,top:b.offset().top+b.outerHeight(!0)}).width(b.outerWidth()-
2)},hide:function(){d(this).data("settings").rList.parent().hide()},caret:function(){var b=d(this)[0];if(document.selection){b.focus();var a=document.selection.createRange(),c=document.selection.createRange().text.length;a.moveStart("character",-b.value.length);return a.text.length-c}return b.selectionStart||"0"==b.selectionStart?b.selectionStart:0},update:function(){var b=d(this),a=b.data("settings");a.tList.children("li").remove();d.each(a.tags,function(b,e){a.tList.append(d("<li/>").html(e))});
if(null!=a.onChange&&"undefined"!=typeof a.onChange)a.onChange(b,a.tags)},keypress:function(b){b.stopPropagation();d(this).data("settings").lastKeyCode=b.keyCode},keydown:function(b){var a=d(this),c=a.data("settings");b.stopPropagation();if(9==b.keyCode){b.preventDefault();var f=c.rList.children("li.active");if(0<f.length){var g="";d.each(c.tags,function(b,a){a==c.lastTag&&(a=c.tags[b]=f.data("value"));g+=a+c.delimiter});a.val(g);e.hide.apply(d(this))}e.update.apply(a)}else if(40==b.keyCode||38==
b.keyCode)b.preventDefault(),f=c.rList.children("li.active"),a=38==b.keyCode?f.prev("li"):f.next("li"),0==a.length&&38==b.keyCode?a=c.rList.children("li:last"):0==a.length&&40==b.keyCode&&(a=c.rList.children("li:first")),c.rList.children("li").removeClass("active"),a.addClass("active")},keyup:function(b){var a=d(this),c=a.data("settings");b.stopPropagation();clearTimeout(e.keyTimer);e.keyTimer=setTimeout(function(){var f=a.val(),g=c.delimiter,j=f.split(g);if(!(9==b.keyCode||40==b.keyCode||38==b.keyCode)){c.tList.children("li").remove();
c.lastTag="";c.tags=[];d.each(j,function(b,a){"undefined"!=typeof a&&(a=a.replace(/^\s+|\s+$/gi,""),""!=a&&c.tags.push(a))});var k=e.caret.apply(a),h=0,i=f.length-1;d.each(f,function(a){if(a<=k){for(h=i=a;0<=h&&!(f[--h]==g););for(h++;i<f.length&&!(f[i++]==g););c.lastTag=f.substring(h,i).replace(/\s+/gi,"").replace(g,"")}});""!=c.lastTag&&c.lastTag!=g?null!=c.onLookup&&"undefined"!=typeof c.onLookup&&(e.show.apply(a),c.onLookup(c.lastTag,c.rList)):c.rList.parent().hide();e.update.apply(a)}},c.keyDelay)}};
d.fn.glAutoTag=function(b){if(e[b])return e[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return e.init.apply(this,arguments);d.error("Method "+b+" does not exist on jQuery.glAutoTag")}})(jQuery);